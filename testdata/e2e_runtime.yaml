# End-to-end runtime tests for ralph-cc
# These tests compile, assemble, link, and run programs, verifying exit codes
# Format: expected_exit is the exit code (0-255), expected_stdout is optional text output

tests:
  # Category 1: Core Features

  ## C1.1: Integer constants
  - name: "C1.1 - integer constant zero"
    input: |
      int main() { return 0; }
    expected_exit: 0

  - name: "C1.1 - integer constant 42"
    input: |
      int main() { return 42; }
    expected_exit: 42

  - name: "C1.1 - integer constant 255"
    input: |
      int main() { return 255; }
    expected_exit: 255

  ## C1.2: Integer arithmetic
  - name: "C1.2 - addition"
    input: |
      int main() { return 3 + 4; }
    expected_exit: 7

  - name: "C1.2 - subtraction"
    input: |
      int main() { return 10 - 3; }
    expected_exit: 7

  - name: "C1.2 - multiplication"
    input: |
      int main() { return 6 * 7; }
    expected_exit: 42

  - name: "C1.2 - division"
    input: |
      int main() { return 42 / 6; }
    expected_exit: 7

  - name: "C1.2 - modulo"
    input: |
      int main() { return 47 % 10; }
    expected_exit: 7

  - name: "C1.2 - complex arithmetic"
    input: |
      int main() { return 2 + 3 * 4 - 5; }
    expected_exit: 9

  ## C1.3: Integer comparisons
  - name: "C1.3 - less than true"
    input: |
      int main() { return 3 < 5; }
    expected_exit: 1

  - name: "C1.3 - less than false"
    input: |
      int main() { return 5 < 3; }
    expected_exit: 0

  - name: "C1.3 - greater than true"
    input: |
      int main() { return 5 > 3; }
    expected_exit: 1

  - name: "C1.3 - greater than false"
    input: |
      int main() { return 3 > 5; }
    expected_exit: 0

  - name: "C1.3 - equal true"
    input: |
      int main() { return 5 == 5; }
    expected_exit: 1

  - name: "C1.3 - equal false"
    input: |
      int main() { return 5 == 3; }
    expected_exit: 0

  - name: "C1.3 - not equal true"
    input: |
      int main() { return 5 != 3; }
    expected_exit: 1

  - name: "C1.3 - not equal false"
    input: |
      int main() { return 5 != 5; }
    expected_exit: 0

  - name: "C1.3 - less equal true"
    input: |
      int main() { return 3 <= 5; }
    expected_exit: 1

  - name: "C1.3 - greater equal true"
    input: |
      int main() { return 5 >= 3; }
    expected_exit: 1

  ## C1.4: Local variables
  - name: "C1.4 - local variable"
    input: |
      int main() { int x = 42; return x; }
    expected_exit: 42

  - name: "C1.4 - multiple local variables"
    input: |
      int main() { int x = 10; int y = 5; return x + y; }
    expected_exit: 15

  ## C1.5: Assignment
  - name: "C1.5 - assignment"
    input: |
      int main() { int x = 0; x = 42; return x; }
    expected_exit: 42

  - name: "C1.5 - chained assignment"
    input: |
      int main() { int x = 0; int y = 0; x = y = 42; return x; }
    expected_exit: 42

  ## C1.6: Function definitions
  - name: "C1.6 - simple function"
    input: |
      int f() { return 42; }
      int main() { return f(); }
    expected_exit: 42

  - name: "C1.6 - function with parameter"
    input: |
      int f(int x) { return x + 1; }
      int main() { return f(41); }
    expected_exit: 42

  ## C1.7: Function calls
  - name: "C1.7 - function call with two args"
    input: |
      int add(int a, int b) { return a + b; }
      int main() { return add(35, 7); }
    expected_exit: 42

  - name: "C1.7 - nested function calls"
    input: |
      int f(int x) { return x * 2; }
      int g(int x) { return f(x) + 1; }
      int main() { return g(20); }
    expected_exit: 41

  ## C1.8: Return statement
  - name: "C1.8 - early return"
    input: |
      int f(int x) { return x; return 0; }
      int main() { return f(42); }
    expected_exit: 42

  ## C1.9: If statement
  - name: "C1.9 - if true branch"
    input: |
      int main() { int x = 0; if (1) x = 42; return x; }
    expected_exit: 42

  - name: "C1.9 - if false no branch"
    input: |
      int main() { int x = 42; if (0) x = 0; return x; }
    expected_exit: 42

  - name: "C1.9 - if with comparison true"
    input: |
      int f(int x) { if (x > 0) return 1; return 0; }
      int main() { return f(5); }
    expected_exit: 1

  - name: "C1.9 - if with comparison false"
    input: |
      int f(int x) { if (x > 0) return 1; return 0; }
      int main() { return f(0); }
    expected_exit: 0

  ## C1.10: If-else statement
  - name: "C1.10 - if-else true"
    input: |
      int main() { if (1) return 42; else return 0; }
    expected_exit: 42

  - name: "C1.10 - if-else false"
    input: |
      int main() { if (0) return 0; else return 42; }
    expected_exit: 42

  - name: "C1.10 - if-else with variable"
    input: |
      int abs(int x) { if (x < 0) return 0 - x; else return x; }
      int main() { return abs(-42); }
    expected_exit: 42

  ## C1.11: While loop
  - name: "C1.11 - while count down"
    input: |
      int main() {
        int n = 5;
        int s = 0;
        while (n > 0) {
          s = s + n;
          n = n - 1;
        }
        return s;
      }
    expected_exit: 15

  - name: "C1.11 - while never runs"
    input: |
      int main() {
        int x = 42;
        while (0) { x = 0; }
        return x;
      }
    expected_exit: 42

  ## C1.12: For loop
  - name: "C1.12 - for loop sum"
    input: |
      int main() {
        int s = 0;
        for (int i = 1; i <= 5; i = i + 1) {
          s = s + i;
        }
        return s;
      }
    expected_exit: 15

  # Category 2: Extended Features

  ## C2.1: Logical operators
  - name: "C2.1 - logical and true"
    input: |
      int main() { return 1 && 1; }
    expected_exit: 1

  - name: "C2.1 - logical and false"
    input: |
      int main() { return 1 && 0; }
    expected_exit: 0

  - name: "C2.1 - logical or true"
    input: |
      int main() { return 0 || 1; }
    expected_exit: 1

  - name: "C2.1 - logical or false"
    input: |
      int main() { return 0 || 0; }
    expected_exit: 0

  - name: "C2.1 - logical not"
    input: |
      int main() { return !0; }
    expected_exit: 1

  - name: "C2.1 - logical and with nonzero values"
    input: |
      int main() { int x = -8; return x && x; }
    expected_exit: 1

  - name: "C2.1 - logical or with nonzero values"
    input: |
      int main() { int x = -8; return x || 0; }
    expected_exit: 1

  - name: "C2.1 - logical and normalizes to 1"
    input: |
      int main() { return (5 && 10) == 1; }
    expected_exit: 1

  - name: "C2.1 - logical or normalizes to 1"
    input: |
      int main() { return (5 || 10) == 1; }
    expected_exit: 1

  ## C2.2: Bitwise operators
  - name: "C2.2 - bitwise and"
    input: |
      int main() { return 15 & 7; }
    expected_exit: 7

  - name: "C2.2 - bitwise or"
    input: |
      int main() { return 8 | 7; }
    expected_exit: 15

  - name: "C2.2 - bitwise xor"
    input: |
      int main() { return 15 ^ 8; }
    expected_exit: 7

  - name: "C2.2 - left shift"
    input: |
      int main() { return 5 << 2; }
    expected_exit: 20

  - name: "C2.2 - right shift"
    input: |
      int main() { return 20 >> 2; }
    expected_exit: 5

  ## C2.3: Increment/decrement
  - name: "C2.3 - prefix increment"
    input: |
      int main() { int x = 41; return ++x; }
    expected_exit: 42

  - name: "C2.3 - postfix increment"
    input: |
      int main() { int x = 42; x++; return x; }
    expected_exit: 43

  - name: "C2.3 - prefix decrement"
    input: |
      int main() { int x = 43; return --x; }
    expected_exit: 42

  ## C2.4: Compound assignment
  - name: "C2.4 - plus equals"
    input: |
      int main() { int x = 40; x += 2; return x; }
    expected_exit: 42

  - name: "C2.4 - minus equals"
    input: |
      int main() { int x = 44; x -= 2; return x; }
    expected_exit: 42

  - name: "C2.4 - times equals"
    input: |
      int main() { int x = 21; x *= 2; return x; }
    expected_exit: 42

  ## C2.5: Ternary operator
  - name: "C2.5 - ternary true"
    input: |
      int main() { return 1 ? 42 : 0; }
    expected_exit: 42

  - name: "C2.5 - ternary false"
    input: |
      int main() { return 0 ? 0 : 42; }
    expected_exit: 42

  ## C2.6: Do-while loop
  - name: "C2.6 - do-while runs once"
    input: |
      int main() {
        int x = 42;
        do { x = x - 1; } while (0);
        return x;
      }
    expected_exit: 41

  ## C2.7: Switch statement
  - name: "C2.7 - switch case"
    input: |
      int main() {
        int x = 2;
        switch (x) {
          case 1: return 10;
          case 2: return 42;
          default: return 0;
        }
      }
    expected_exit: 42

  ## C2.8: Break/continue
  - name: "C2.8 - break in loop"
    input: |
      int main() {
        int i = 0;
        while (1) {
          i = i + 1;
          if (i == 42) break;
        }
        return i;
      }
    expected_exit: 42

  ## C2.9: Pointers
  - name: "C2.9 - pointer dereference"
    input: |
      int main() {
        int x = 42;
        int *p = &x;
        return *p;
      }
    expected_exit: 42

  - name: "C2.9 - pointer write"
    input: |
      int main() {
        int x = 0;
        int *p = &x;
        *p = 42;
        return x;
      }
    expected_exit: 42

  ## C2.10: Address-of (tested above with pointers)

  ## C2.11: Arrays
  - name: "C2.11 - array access"
    input: |
      int main() {
        int a[3];
        a[0] = 10;
        a[1] = 20;
        a[2] = 12;
        return a[0] + a[1] + a[2];
      }
    expected_exit: 42

  ## C2.12: String literals
  - name: "C2.12 - string literal assignment"
    input: |
      int main() {
        char *s = "hello";
        return 42;
      }
    expected_exit: 42

  ## C2.13: Character literals
  - name: "C2.13 - char literal"
    input: |
      int main() { return 'A' - 23; }
    expected_exit: 42

  # Category 3: Type System

  ## C3.1: Char type
  - name: "C3.1 - char variable"
    input: |
      int main() { char c = 42; return c; }
    expected_exit: 42

  ## C3.8: Void type
  - name: "C3.8 - void function"
    input: |
      void f() { return; }
      int main() { f(); return 42; }
    expected_exit: 42

  # Category 4: I/O Integration (tested in hello.c)
